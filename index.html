<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יומן עבודה - Stonhard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Manager View -->
    <div id="managerView" class="view-container">
        <header class="header">
            <h1>📝 יומן עבודה יומי</h1>
            <p>Stonhard Installation - אבשי ספיר</p>
            <p class="legal-notice">⚖️ תיעוד משפטי מלא - תקנות התכנון והבניה 1992</p>
        </header>

        <main class="container">
            <form id="reportForm">
                <!-- Project Info -->
                <section class="section">
                    <h2>📋 פרטי פרוייקט</h2>
                    <div class="form-row">
                        <input type="text" id="projectName" placeholder="שם פרוייקט" required>
                        <input type="date" id="reportDate" required>
                    </div>
                    <div class="form-row">
                        <select id="weather">
                            <option value="">מזג אוויר</option>
                            <option value="sunny">☀️ שמש</option>
                            <option value="cloudy">⛅ מעונן</option>
                            <option value="rainy">🌧️ גשום</option>
                            <option value="hot">🌡️ חם מאוד</option>
                            <option value="cold">❄️ קר</option>
                            <option value="windy">💨 רוח חזקה</option>
                        </select>
                    </div>
                </section>

                <!-- Work Hours -->
                <section class="section">
                    <h2>⏰ שעות עבודה</h2>
                    <div class="form-row">
                        <input type="time" id="startTime" placeholder="שעת התחלה">
                        <input type="time" id="endTime" placeholder="שעת סיום">
                        <input type="number" id="breakHours" value="0" step="0.5" placeholder="הפסקות (שעות)">
                    </div>
                    <div class="total-hours">
                        <strong>סה"כ שעות עבודה:</strong> <span id="totalWorkHours">0</span> שעות
                    </div>
                </section>

                <!-- Workers -->
                <section class="section">
                    <h2>👷 כוח אדם</h2>
                    <div id="workersContainer"></div>
                    <button type="button" class="btn-add" onclick="addWorkerRow()">➕ הוסף עובד</button>
                    <div class="total-hours">
                        <strong>סה"כ שעות כוח אדם:</strong> <span id="totalWorkerHours">0</span> שעות
                    </div>
                </section>

                <!-- Activities -->
                <section class="section">
                    <h2>🔨 פעילויות</h2>
                    <div id="activitiesContainer"></div>
                    <button type="button" class="btn-add" onclick="addActivityRow()">➕ הוסף פעילות</button>
                </section>

                <!-- LEGAL SECTION 1: Material Deliveries -->
                <section class="section legal-section">
                    <h2>📦 אספקות חומרים <span class="legal-badge">חובה לפי חוק</span></h2>
                    <p class="helper-text">תיעוד חומרים שהגיעו לאתר - נדרש להוכחת תשלום</p>
                    <div id="materialsContainer"></div>
                    <button type="button" class="btn-add" onclick="addMaterialRow()">➕ הוסף חומר</button>
                </section>

                <!-- LEGAL SECTION 2: Equipment & Machinery -->
                <section class="section legal-section">
                    <h2>🚜 ציוד ומכונות <span class="legal-badge">חובה לפי חוק</span></h2>
                    <p class="helper-text">רישום ציוד בשימוש - נדרש למעקב עלויות</p>
                    <div id="equipmentContainer"></div>
                    <button type="button" class="btn-add" onclick="addEquipmentRow()">➕ הוסף ציוד</button>
                </section>

                <!-- LEGAL SECTION 3: Safety Incidents -->
                <section class="section legal-section critical">
                    <h2>⚠️ בטיחות ואירועים <span class="legal-badge critical">קריטי</span></h2>
                    <p class="helper-text">תיעוד אירועי בטיחות - חובה לפי חוק הבטיחות בעבודה</p>
                    <div id="safetyContainer"></div>
                    <button type="button" class="btn-add" onclick="addSafetyRow()">➕ הוסף אירוע</button>
                </section>

                <!-- LEGAL SECTION 4: Regulatory Inspections -->
                <section class="section legal-section critical">
                    <h2>👮 ביקורות ופיקוח <span class="legal-badge critical">קריטי</span></h2>
                    <p class="helper-text">רישום ביקורות מפקחים - חובה לפי תקנות התכנון והבניה 1992</p>
                    <div id="inspectionsContainer"></div>
                    <button type="button" class="btn-add" onclick="addInspectionRow()">➕ הוסף ביקורת</button>
                </section>

                <!-- LEGAL SECTION 5: Delays -->
                <section class="section legal-section">
                    <h2>⏰ עיכובים והפסקות <span class="legal-badge">חובה לפי חוק</span></h2>
                    <p class="helper-text">תיעוד עיכובים - נדרש לקביעת אחריות ותשלומים</p>
                    <div id="delaysContainer"></div>
                    <button type="button" class="btn-add" onclick="addDelayRow()">➕ הוסף עיכוב</button>
                </section>

                <!-- Notes & Photos -->
                <section class="section">
                    <h2>📝 הערות ותמונות</h2>
                    <div class="voice-textarea-container">
                        <textarea id="generalNotes" placeholder="הערות כלליות... (לחץ 🎤 להקלטה)"></textarea>
                        <button type="button" class="btn-voice" id="voiceNotesBtn" title="הקלט קולי">🎤</button>
                    </div>
                    
                    <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                        <span>📷 לחץ להוספת תמונות</span>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" capture="environment" multiple style="display:none;">
                    <div id="photoPreview" class="photo-preview"></div>
                </section>

                <!-- Tomorrow's Work Plan -->
                <section class="section">
                    <h2>📅 תוכנית עבודה למחר</h2>
                    <div class="form-row">
                        <input type="date" id="tomorrowDate" placeholder="תאריך">
                    </div>
                    <div class="voice-textarea-container">
                        <textarea id="tomorrowPlan" placeholder="תוכנית עבודה למחר... (לחץ 🎤 להקלטה)"></textarea>
                        <button type="button" class="btn-voice" id="voiceTomorrowBtn" title="הקלט קולי">🎤</button>
                    </div>
                </section>

                <!-- Signature -->
                <section class="section">
                    <h2>✍️ חתימה</h2>
                    <canvas id="signatureCanvas" class="signature-pad"></canvas>
                    <div class="btn-group">
                        <button type="button" class="btn-secondary" onclick="clearSignature()">🗑️ נקה</button>
                    </div>
                </section>

                <!-- Actions -->
                <section class="section">
                    <button type="button" id="saveBtn" class="btn-primary">💾 שמור טיוטה</button>
                    <button type="button" id="sendBtn" class="btn-success">📤 שלח לאישור</button>
                </section>
            </form>
        </main>
    </div>

    <!-- Owner View -->
    <div id="ownerView" class="view-container" style="display:none;">
        <header class="header no-print">
            <div class="security-badge">🔒 דוח מאובטח</div>
            <h1>אישור דוח עבודה</h1>
            <button class="btn-print" onclick="printReport()">🖨️ הדפס</button>
        </header>

        <main class="container" id="printableArea">
            <div id="reportDetails"></div>
            
            <!-- Owner Photos Section -->
            <section class="section no-print">
                <h2>📸 הוסף תמונות שלך (אופציונלי)</h2>
                <p class="helper-text">תעד ממצאים או מצב סופי</p>
                <div class="photo-upload" onclick="document.getElementById('ownerPhotoInput').click()">
                    <span>📷 לחץ להוספת תמונות</span>
                </div>
                <input type="file" id="ownerPhotoInput" accept="image/*" capture="environment" multiple style="display:none;">
                <div id="ownerPhotoPreview" class="photo-preview"></div>
            </section>
            
            <section class="section no-print">
                <h2>✍️ אישור</h2>
                <input type="text" id="ownerName" placeholder="שם מלא">
                
                <div class="voice-textarea-container">
                    <textarea id="ownerRemarks" placeholder="הערות (אופציונלי - לחץ 🎤 להקלטה)"></textarea>
                    <button type="button" class="btn-voice" id="voiceRemarksBtn" title="הקלט קולי">🎤</button>
                </div>
                
                <canvas id="ownerSignature" class="signature-pad"></canvas>
                <div class="btn-group">
                    <button onclick="clearOwnerSignature()" class="btn-secondary">🗑️ נקה</button>
                    <button onclick="approveReport()" class="btn-success">✅ אשר ושלח</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;">
        <div class="spinner"></div>
        <p>טוען...</p>
    </div>

    <!-- Voice Recording Indicator -->
    <div id="voiceIndicator" class="voice-indicator" style="display:none;">
        <div class="voice-pulse"></div>
        <p>🎤 מקליט... דבר עכשיו</p>
        <button onclick="stopVoiceRecording()" class="btn-stop">⏹️ עצור</button>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>